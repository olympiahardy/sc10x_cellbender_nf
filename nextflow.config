params {
    input_glob = null
    outdir     = 'results'
}

/*
 * Base process config
 */
process {
    executor      = 'local'
    maxRetries    = 1
    errorStrategy = 'terminate'

    // IMPORTANT: process selector needs the name as a string
    withName: 'SCANPY_QC_CELLRANGER' {
        // publishDir expects a map: key: value, not a bare list
        publishDir = [ path: params.outdir, mode: 'move', overwrite: true ]
    }

    withName: 'CELLBENDER_REMOVE_BACKGROUND' {
        publishDir = [ path: "${params.outdir}/h5_files", mode: 'move', overwrite: true ]
    }
}

profiles {

    cpu {
        process.executor = 'local'
    }

    gpu {
        process.executor = 'local'

        withName: 'CELLBENDER_REMOVE_BACKGROUND' {
            // if you want to be explicit about GPU:
            env.CUDA_VISIBLE_DEVICES = '0'
        }
    }
}